<link rel="stylesheet" type="text/css" href="signup.css">
<form method="post" class="signup" autocomplete="off">
  <label class="signup-field">
    <div class="signup-field-wrap">
      <div class="signup-field-confirmed">You're on!</div>
      <input type="text" class="signup-field-number" placeholder="What's your phonenumber?">
      <input type="text" class="signup-field-name" placeholder="What's your name?">
    </div>
  </label>
  <input type="submit" style="visiblity:hidden;position:absolute;top:-100px;"/>
</form>
<p class="explanation">Your phonenumber is safe with us. We just need it to contact the winner!</p>

<script>
  var $form      = $('.signup'),
      $confirmed = $('.signup-field-confirmed'),
      $number    = $('.signup-field-number'),
      $name      = $('.signup-field-name');

  $number.focus();

  function isInputKey (e) {
    var code  = e.keyCode;
    var number = (code >= 48 && code <= 57)
    var enter = code == 13;
    var bs = code == 8;

    /* var left  = code == 37; */
    /* var right = code == 39; */
    /* var tab   = code == 9; */
    /* var shift = code == 16; */

    return number || enter || bs;
  }

  var lastNumber;
  $number.keyup(function (e) {
    if (!isInputKey(e)) {
      return;
    }

    var number = $number.val();

    if (number === lastNumber) {
      return;
    }

    lastNumber = number;

    $name.val('');
    API.getUser(number, function (user) {
      if (user && user.name) {
        $name.val(user.name);
      }
    });
  });

  $form.submit(function submit (e) {
    var number = $.trim($number.val()),
        name   = $.trim($name.val());

    if (!number || !name) {
      return false;
    }

    $confirmed.addClass('confirmed--flash');
    setTimeout(function () {
      $confirmed.removeClass('confirmed--flash');
    }, 900);

    API.signUp(number, name);
    $number.val("");
    $name.val("");
    $number.focus();
    return false;
  });

</script>
